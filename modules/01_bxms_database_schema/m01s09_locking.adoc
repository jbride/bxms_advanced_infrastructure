:scrollbar:
:data-uri:
:noaudio:

== Optimistic and Pessimistic Locking

* JPA in JBoss BPM Suite engine uses by default optimistic locking strategy with versioning
* May lead to race conditions -- `OptimisticLockException`
** Process definitions with wait states or asynchronous nodes in parallel branches
* Engine can recover from `OptimisticLockException`
** Failing branch is re-executed within same transaction
* JBoss BPM Suite engine can be configured to use pessimistic locking strategy
** JPA `PESSIMISTIC_FORCE_INCREMENT` lock mode
** Enable pessimistic locking by setting environment entry `org.kie.api.persistence.pessimistic` to `true` in kjar deployment descriptor:
+
[source,xml]
----
    <environment-entries>
        <environment-entry>
            <name>org.kie.api.persistence.pessimistic</name>
            <resolver>mvel</resolver>
            <identifier>true</identifier>
        </environment-entry>
    </environment-entries>
----

 
